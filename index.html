<!-- blah blah -->
<style>
  body { width: 650px; margin: 20px auto; font-family: arial; }
  pre { background: #def; padding: 5px; width: 650px; font-family: monospace; }
  a.fork { float: right; background: #def; padding: 10px; }
</style>
<a class=fork href=//github.com/xem/MiniSweeper>Fork me!</a>
<h1>MiniSweeper</h1>
<h2>A minesweeper in 651 characters</h2>
<b>Golfed by <a href=//twitter.com/MaximeEuziere>xem</a></b>
<br>
<pre>
&lt;table border id=t>&lt;script>s=25;b=[];f=[];n=[];v=[];H="";h=1;g=l=r=0;p=function(
a){if(!g){l&&(v[a]=1,b[a]&&(g=-1));r&&(f[a]=!f[a],g=1);for(m=1;m;){for(j=m=0;j&lt;s
*s;j++)r&&b[j]==!f[j]&&(g=0),h&&(n[j]=0);for(j=0;j&lt;s*s;j++){J=~~(j/s);I=j%s;V=" 
 ";h&&(H+=(j%s?"":"&lt;tr>")+"&lt;td id=c"+j+" align=center bgcolor=ddddd onclick=l=1;
p("+j+") oncontextmenu=r=1;p("+j+");return!1>"+V,b[j]=0.1>Math.random());for(y=2
;--y+2;)for(x=2;--x+2;)B=J+y,A=I+x,C=B*s+A,0&lt;=B&&0&lt;=A&&B&lt;s&&A&lt;s&&(h&&b[j]&&n[C]+
+,h||!v[j]||n[j]||v[C]||b[C]||(m=v[C]=1));!h&&(Z=this["c"+j],Z[z]=f[j]?"⚑":b[j]&
&g?"💣":v[j]||g?n[j]||V:V,g||v[j])&&(Z.style.background=0)}}g&&alert("☹ 😁"[g+1])
;l=r=h=0}};p();t[z="innerHTML"]=H&lt;/script> // 681 (or 651 with JSCrush)
</pre>

<h2>Demo:</h2>
- Left click to reveal a cell and see how many bombs are around.
<br>
- Don't click on bombs! Right click to set a flag where you believe there is a bomb.
<br>
- You win when all the bombs are flagged.
<br>
<br>

<!-- Code golf -->

<table border id=t><script>s=25;b=[];f=[];n=[];v=[];H="";h=1;g=l=r=0;p=function(a){if(!g){l&&(v[a]=1,b[a]&&(g=-1));r&&(f[a]=!f[a],g=1);for(m=1;m;){for(j=m=0;j<s*s;j++)r&&b[j]==!f[j]&&(g=0),h&&(n[j]=0);for(j=0;j<s*s;j++){J=~~(j/s);I=j%s;V="  ";h&&(H+=(j%s?"":"<tr>")+"<td id=c"+j+" align=center bgcolor=ddddd onclick=l=1;p("+j+") oncontextmenu=r=1;p("+j+");return!1>"+V,b[j]=0.1>Math.random());for(y=2;--y+2;)for(x=2;--x+2;)B=J+y,A=I+x,C=B*s+A,0<=B&&0<=A&&B<s&&A<s&&(h&&b[j]&&n[C]++,h||!v[j]||n[j]||v[C]||b[C]||(m=v[C]=1));!h&&(Z=this["c"+j],Z[z]=f[j]?"⚑":b[j]&&g?"💣":v[j]||g?n[j]||V:V,g||v[j])&&(Z.style.background=0)}}g&&alert("☹ 😁"[g+1]);l=r=h=0}};p();t[z="innerHTML"]=H</script>


<!-- Original source code -->

<!--
<table border id=t>
<script>
/*s=25; // Grid size
b=[]; // Bombs
f=[]; // Flags
n=[]; // Neighbours counters
v=[]; // Viewed cells
H=""; // HTML code
h=1;  // Generate HTML
g=    // Game over (1: win / -1: lost)
l=    // Left click
r=0;  // Right click

// All-purpose function
p=function(i){
  
  // If the game isn't over
  if(!g){
    
    // Left click
    if(l){
      v[i]=1;
      if(b[i]){
        g=-1;
      }
    }
    
    // Right click
    if(r){
      f[i]=!f[i];
      g=1;
    }
  
    // While there's more to view
    for(m=1;m;){
      m=0;

      // Test if the game is won
      for(j=0;j<s*s;j++){
        if(r && b[j] == !f[j]){
          g=0;
        }
        if(h){
          n[j]=0;
        }
      }

      // Iterate on cells
      for(j=0;j<s*s;j++){
        J=~~(j/s);
        I=j%s;
      
        // Empty
        V="  ";
        
        // Generate HTML
        if(h){
          H+=(j%s?"":"<tr>")+"<td id=c"+j+" align=center bgcolor=eeeee onclick=l=1;p("+j+") oncontextmenu=r=1;p("+j+");return!1>"+V;
          b[j]=Math.random()<.1;
        }

        // Iterate
        for(y=2;--y+2;){
          for(x=2;--x+2;){
            B=J+y;
            A=I+x;
            C=B*s+A;
            if(B>=0 && A>=0 && B<s && A<s){
            
              // Count neighbours
              if(h && b[j]){
                n[C]++;
              }
              
              // Try to expand
              if(!h && v[j] && !n[j] && !v[C] && !b[C]){
                v[C]=1;
                m=1;
              }
            }
          }
        }

        // Render
        if(!h){
          Z=this["c"+j];
          Z[z]=f[j]?"⚑":((b[j]&&g)?"💣":((v[j]||g)?(n[j]||V):V));
          if(g||v[j]){
            Z.style.background=0;
          }
        }
      }
    }

    // Won/lost
    if(g){
      alert(["☹ 😁"][g+1]);
    }
    
    // Reset state
    l=r=h=0;
  }
}
p();
t[z="innerHTML"]=H;*/
</script>
-->